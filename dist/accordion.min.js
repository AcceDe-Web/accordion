/**
 * @accede-web/accordion - WAI-ARIA accordion plugin based on AcceDe Web accessibility guidelines
 * @version v1.0.1
 * @link http://a11y.switch.paris/
 * @license ISC
 **/
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.Accordion=t()}(this,function(){"use strict";var e=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}();var t=["hide","show"],n=["H1","H2","H3","H4","H5","H6"];return function(){function a(e){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),!e||!e.nodeName)throw new Error("No DOM node provided. Abort.");this.el=e,this.multiselectable="true"===this.el.getAttribute("data-multiselectable"),this._accordion={},this._callbacks={},this._handleDisplay=this._handleDisplay.bind(this),this._handleFocus=this._handleFocus.bind(this),this._handleHeaders=this._handleHeaders.bind(this),this._handlePanelFocus=this._handlePanelFocus.bind(this),this._handlePanel=this._handlePanel.bind(this)}return e(a,[{key:"_firstActiveHeader",value:function(){var e=void 0;return this._accordion.headers.some(function(t,n){if(!t.disabled)return e=n,!0}),e}},{key:"_handleDisplay",value:function(e){e.preventDefault();var t=e.currentTarget;t.disabled||(t!==document.activeElement&&t.focus(),this._toggleDisplay(this._accordion.headers.indexOf(t)))}},{key:"_handleFocus",value:function(e){var t=e.currentTarget;t.disabled||(this._accordion.currentIndex=this._accordion.headers.indexOf(t))}},{key:"_handlePanel",value:function(e){switch(void 0===this._accordion.currentIndex&&this._handlePanelFocus(e),e.keyCode){case 33:e.ctrlKey&&(e.preventDefault(),this._switchPanel(this._accordion.currentIndex-1));break;case 34:e.ctrlKey&&(e.preventDefault(),this._switchPanel(this._accordion.currentIndex+1));break;case 38:e.ctrlKey&&(e.preventDefault(),this._switchPanel(this._accordion.currentIndex))}}},{key:"_handlePanelFocus",value:function(e){if(e.target.doubleFocus)return e.preventDefault(),void delete e.target.doubleFocus;var t=e.currentTarget;this._accordion.currentIndex=this._accordion.panels.indexOf(t),["radio","checkbox"].indexOf(e.target.type)>=0&&(e.target.doubleFocus=!0)}},{key:"_handleHeaders",value:function(e){switch(void 0===this._accordion.currentIndex&&this._handleFocus(e),e.keyCode){case 32:case 13:this._handleDisplay(e);break;case 35:e.preventDefault(),this._switchPanel(this._accordion.headers.length-1);break;case 36:e.preventDefault(),this._switchPanel(this._firstActiveHeader());break;case 37:case 38:e.preventDefault(),this._switchPanel(this._accordion.currentIndex-1);break;case 39:case 40:e.preventDefault(),this._switchPanel(this._accordion.currentIndex+1)}}},{key:"_noop",value:function(){}},{key:"_switchPanel",value:function(e){if(this._accordion.headers[e]&&this._accordion.headers[e].disabled){var t=e>this._accordion.currentIndex?e+1:e-1;this._switchPanel(t)}else{var n=this._firstActiveHeader();e<n?this._accordion.currentIndex=this._accordion.headersLength-1:e>=this._accordion.headersLength?this._accordion.currentIndex=n:this._accordion.currentIndex=e,this._accordion.headers[this._accordion.currentIndex].focus()}}},{key:"_toggleDisplay",value:function(e,t){var n=this._accordion.headers[e],a=this._accordion.panels[e],i="true"===n.getAttribute("aria-expanded");void 0===t&&(t="false"===n.getAttribute("aria-expanded")),t&&i||!t&&!i||(t&&!this.multiselectable&&void 0!==this._accordion.openedIndexes[0]&&this._toggleDisplay(this._accordion.openedIndexes[0],!1),n.setAttribute("aria-expanded",t),a.setAttribute("aria-hidden",!t),t?(this._accordion.openedIndexes.push(e),this._trigger("show",[n,a])):(this._accordion.openedIndexes.splice(this._accordion.openedIndexes.indexOf(e),1),this._trigger("hide",[n,a])))}},{key:"_trigger",value:function(e,t){var n=this;this._callbacks[e]&&this._callbacks[e].forEach(function(e){e.apply(n,t)})}},{key:"closeAll",value:function(){var e=this;this._accordion.panels.forEach(function(t,n){e._toggleDisplay(n,!1)})}},{key:"close",value:function(e){var t=this._accordion.panels.indexOf(e);this._toggleDisplay(t,!1)}},{key:"mount",value:function(){var e=this;this._accordion.headers=[],this._accordion.panels=[],this._accordion.openedIndexes=[],Array.prototype.slice.call(this.el.children).forEach(function(t,a){if((n.indexOf(t.nodeName)>-1||"heading"===t.getAttribute("role")||t.hasAttribute("aria-level"))&&(t=t.querySelector('button[aria-controls], [role="button"][aria-controls]'))){var i=document.getElementById(t.getAttribute("aria-controls")),r=!1;if(!i)throw new Error("Could not find associated panel for header "+t.id+'. Use [aria-controls="panelId"] on the [role="header"] element to link them together');e._accordion.headers.push(t),e._accordion.panels.push(i),t.disabled=t.hasAttribute("disabled")||"true"===t.getAttribute("aria-disabled"),"true"!==t.getAttribute("data-expand")||t.disabled||(e.multiselectable||!e.multiselectable&&!e._accordion.openedIndexes.length)&&(e._toggleDisplay(a,!0),r=!0),t.removeAttribute("data-expand"),t.setAttribute("tabindex",0),t.setAttribute("aria-expanded",r),i.setAttribute("aria-hidden",!r),t.addEventListener("click",e._handleDisplay),t.addEventListener("focus",e._handleFocus),t.addEventListener("keydown",e._handleHeaders),i.addEventListener("focus",e._handlePanelFocus,!0),i.addEventListener("keydown",e._handlePanel)}}),this._accordion.headersLength=this._accordion.headers.length,this._accordion.panelsLength=this._accordion.panels.length}},{key:"off",value:function(e,t){if(this._callbacks[e]){var n=this._callbacks[e].indexOf(t);n<0||this._callbacks[e].splice(n,1)}}},{key:"on",value:function(e,n){t.indexOf(e)<0||(this._callbacks[e]||(this._callbacks[e]=[]),this._callbacks[e].push(n))}},{key:"unmount",value:function(){var e=this;this._accordion.headers.forEach(function(t,n){var a=e._accordion.panels[n];t.removeEventListener("click",e._handleDisplay),t.removeEventListener("focus",e._handleFocus),t.removeEventListener("keydown",e._handleHeaders),t.removeAttribute("tabindex"),t.removeAttribute("aria-expanded"),a.removeEventListener("focus",e._handlePanelFocus,!0),a.removeEventListener("keydown",e._handlePanel),a.setAttribute("aria-hidden","false")})}},{key:"current",get:function(){var e=this;return this._accordion.openedIndexes.map(function(t){return{header:e._accordion.headers[t],panel:e._accordion.panels[t]}})}}]),a}()});
